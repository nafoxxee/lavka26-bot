#!/usr/bin/env python3
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π
"""

import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

def test_promo_ad_config():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π"""
    print("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π...")
    
    try:
        from config import PROMO_AD_PRICE, PROMOTION_PRICES
        
        print(f"‚úÖ –¶–µ–Ω–∞ —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è: {PROMO_AD_PRICE} ‚ÇΩ")
        print(f"‚úÖ –¶–µ–Ω—ã –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è: {PROMOTION_PRICES}")
        
        if PROMO_AD_PRICE == 50:
            print("‚úÖ –¶–µ–Ω–∞ —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞")
        else:
            print(f"‚ö†Ô∏è –û–∂–∏–¥–∞–µ–º–∞—è —Ü–µ–Ω–∞ 50 ‚ÇΩ, —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∞—è {PROMO_AD_PRICE} ‚ÇΩ")
        
        return True
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: {e}")
        return False

def test_promo_ad_handlers():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π"""
    print("\nüîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π...")
    
    try:
        from handlers import handle_promo_category, handle_promo_info, setup_handlers
        print("‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∑–∞–≥—Ä—É–∂–µ–Ω—ã")
        
        from bot import create_promo_ad_start, skip_promo_photos, handle_promo_duration
        print("‚úÖ –§—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π –∑–∞–≥—Ä—É–∂–µ–Ω—ã")
        
        from payments import setup_payment_handlers
        print("‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π –∑–∞–≥—Ä—É–∂–µ–Ω—ã")
        
        return True
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤: {e}")
        return False

def test_promo_ad_keyboards():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä –¥–ª—è —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π"""
    print("\nüîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä –¥–ª—è —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π...")
    
    try:
        from keyboards import categories_keyboard
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–†–µ–∫–ª–∞–º–∞"
        promo_found = False
        for row in categories_keyboard.inline_keyboard:
            for button in row:
                if "–†–µ–∫–ª–∞–º–∞" in button.text and "50 ‚ÇΩ" in button.text:
                    promo_found = True
                    print(f"‚úÖ –ù–∞–π–¥–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ —Ä–µ–∫–ª–∞–º—ã: {button.text}")
                    break
        
        if not promo_found:
            print("‚ö†Ô∏è –ö–Ω–æ–ø–∫–∞ —Ä–µ–∫–ª–∞–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö")
        
        return promo_found
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä: {e}")
        return False

def test_promo_ad_flow():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è"""
    print("\nüîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è...")
    
    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —à–∞–≥–∏ —Å–æ–∑–¥–∞–Ω–∏—è
        steps = [
            'promo_ad_photos',
            'promo_ad_title', 
            'promo_ad_description',
            'promo_ad_price',
            'promo_ad_contacts',
            'promo_ad_duration'
        ]
        
        print("‚úÖ –®–∞–≥–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è:")
        for step in steps:
            print(f"   - {step}")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å—Ä–æ–∫–∞
        durations = {
            '30': 0,      # 30 –¥–Ω–µ–π, –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ 50 ‚ÇΩ
            '90': 100,    # 90 –¥–Ω–µ–π, +100 ‚ÇΩ = 150 ‚ÇΩ
            '120': 200    # 120 –¥–Ω–µ–π, +200 ‚ÇΩ = 250 ‚ÇΩ
        }
        
        print("‚úÖ –í–∞—Ä–∏–∞–Ω—Ç—ã —Å—Ä–æ–∫–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏:")
        for days, extra_cost in durations.items():
            total = 50 + extra_cost
            print(f"   - {days} –¥–Ω–µ–π: {total} ‚ÇΩ")
        
        return True
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–∏–∫–∏: {e}")
        return False

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    print("üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π Lavka26 Bot\n")
    
    tests = [
        ("–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è", test_promo_ad_config),
        ("–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏", test_promo_ad_handlers),
        ("–ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã", test_promo_ad_keyboards),
        ("–õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è", test_promo_ad_flow)
    ]
    
    results = []
    for test_name, test_func in tests:
        result = test_func()
        results.append((test_name, result))
    
    print("\n" + "="*50)
    print("üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:")
    print("="*50)
    
    all_passed = True
    for test_name, result in results:
        status = "‚úÖ –ü–†–û–ô–î–ï–ù" if result else "‚ùå –ù–ï –ü–†–û–ô–î–ï–ù"
        print(f"{test_name}: {status}")
        if not result:
            all_passed = False
    
    print("\n" + "="*50)
    
    if all_passed:
        print("üéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´!")
        print("\nüìã –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π –≥–æ—Ç–æ–≤:")
        print("   ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è '–†–µ–∫–ª–∞–º–∞ (50 ‚ÇΩ)' –≤ –º–µ–Ω—é")
        print("   ‚úÖ –ü–æ—à–∞–≥–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è")
        print("   ‚úÖ –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Telegram Payments")
        print("   ‚úÖ –í—ã–±–æ—Ä —Å—Ä–æ–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è (30/90/120 –¥–Ω–µ–π)")
        print("   ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –∑–∞ –ø—Ä–æ–¥–ª–µ–Ω–Ω—ã–π —Å—Ä–æ–∫")
        print("   ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –¥–ª—è —Ä–µ–∫–ª–∞–º—ã")
        print("   ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ")
        
        print("\nüöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞: python bot.py")
        print("\nüí° –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∫–ª–∞–º–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è:")
        print("1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é '–†–µ–∫–ª–∞–º–∞ (50 ‚ÇΩ)'")
        print("2. –ù–∞–∂–∏–º–∞–µ—Ç '–û–ø–ª–∞—Ç–∏—Ç—å 50 ‚ÇΩ'")
        print("3. –ü—Ä–æ—Ö–æ–¥–∏—Ç –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ Telegram Payments")
        print("4. –°–æ–∑–¥–∞–µ—Ç —Ä–µ–∫–ª–∞–º–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ (7 —à–∞–≥–æ–≤)")
        print("5. –í—ã–±–∏—Ä–∞–µ—Ç —Å—Ä–æ–∫ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è")
        print("6. –û–ø–ª–∞—á–∏–≤–∞–µ—Ç –¥–æ–ø. —Å—Ç–æ–∏–º–æ—Å—Ç—å (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)")
        print("7. –†–µ–∫–ª–∞–º–∞ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏")
    else:
        print("‚ùå –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ–π–¥–µ–Ω—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—à–∏–±–∫–∏ –≤—ã—à–µ.")
    
    return all_passed

if __name__ == "__main__":
    success = main()
    sys.exit(0 if success else 1)
