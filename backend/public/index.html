<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Lavka26 - –û–±—ä—è–≤–ª–µ–Ω–∏—è</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css?v=4">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ -->
        <header class="app-header">
            <div class="header-left">
                <button class="header-btn back-btn" id="back-btn" onclick="goBack()" style="display: none;">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="app-title" id="header-title">Lavka26</div>
            </div>
            <div class="header-right">
                <button class="header-btn" onclick="switchTab('profile')">
                    <i class="fas fa-user"></i>
                </button>
            </div>
        </header>

        <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ -->
        <main class="app-content">
            <!-- –ì–ª–∞–≤–Ω–∞—è: –õ–µ–Ω—Ç–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π -->
            <div class="tab-content active" id="feed-tab">
                <!-- –ü–æ–∏—Å–∫–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ -->
                <div class="search-section">
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ –∏ —É—Å–ª—É–≥">
                        <button class="search-btn" onclick="performSearch()">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <!-- –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
                    <div class="category-filter" id="category-filter" style="display: none;">
                        <select class="category-select" id="search-category">
                            <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                            <option value="transport">üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
                            <option value="electronics">üì± –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</option>
                            <option value="property">üè† –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</option>
                            <option value="clothing">üëï –û–¥–µ–∂–¥–∞</option>
                            <option value="jobs">üíº –†–∞–±–æ—Ç–∞</option>
                            <option value="services">üîß –£—Å–ª—É–≥–∏</option>
                            <option value="animals">üêæ –ñ–∏–≤–æ—Ç–Ω—ã–µ</option>
                            <option value="other">üì¶ –ü—Ä–æ—á–µ–µ</option>
                        </select>
                    </div>
                </div>

                <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                <div class="categories-section">
                    <div class="section-header">
                        <h2>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
                    </div>
                    <div class="categories-grid">
                        <div class="category-item" onclick="filterByCategory('transport')">
                            <i class="fas fa-car"></i>
                            <span>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</span>
                        </div>
                        <div class="category-item" onclick="filterByCategory('electronics')">
                            <i class="fas fa-mobile"></i>
                            <span>–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</span>
                        </div>
                        <div class="category-item" onclick="filterByCategory('property')">
                            <i class="fas fa-home"></i>
                            <span>–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</span>
                        </div>
                        <div class="category-item" onclick="filterByCategory('clothing')">
                            <i class="fas fa-tshirt"></i>
                            <span>–û–¥–µ–∂–¥–∞</span>
                        </div>
                        <div class="category-item" onclick="filterByCategory('jobs')">
                            <i class="fas fa-briefcase"></i>
                            <span>–†–∞–±–æ—Ç–∞</span>
                        </div>
                        <div class="category-item" onclick="filterByCategory('services')">
                            <i class="fas fa-tools"></i>
                            <span>–£—Å–ª—É–≥–∏</span>
                        </div>
                        <div class="category-item" onclick="filterByCategory('animals')">
                            <i class="fas fa-paw"></i>
                            <span>–ñ–∏–≤–æ—Ç–Ω—ã–µ</span>
                        </div>
                        <div class="category-item" onclick="filterByCategory('other')">
                            <i class="fas fa-box"></i>
                            <span>–ü—Ä–æ—á–µ–µ</span>
                        </div>
                    </div>
                </div>

                <!-- –°–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π -->
                <div class="ads-section">
                    <div class="ads-grid" id="ads-grid">
                        <div class="loading-placeholder">
                            <div class="skeleton-card"></div>
                            <div class="skeleton-card"></div>
                            <div class="skeleton-card"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ò–∑–±—Ä–∞–Ω–Ω–æ–µ -->
            <div class="tab-content" id="favorites-tab" style="display: none;">
                <div class="section-header">
                    <h2>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h2>
                </div>
                <div class="ads-grid" id="favorites-grid">
                    <div class="empty-state">
                        <i class="fas fa-heart"></i>
                        <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π</p>
                    </div>
                </div>
            </div>

            <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
            <div class="tab-content" id="messages-tab" style="display: none;">
                <div class="section-header">
                    <h2>–°–æ–æ–±—â–µ–Ω–∏—è</h2>
                </div>
                <div class="messages-list" id="messages-list">
                    <div class="empty-state">
                        <i class="fas fa-comment"></i>
                        <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</p>
                    </div>
                </div>
            </div>

            <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
            <div class="tab-content" id="profile-tab" style="display: none;">
                <div class="profile-section">
                    <div class="profile-header">
                        <div class="profile-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="profile-info">
                            <h2 id="profile-name">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
                            <p id="profile-phone">+7 XXX XXX-XX-XX</p>
                        </div>
                    </div>
                    
                    <div class="profile-stats">
                        <div class="stat-item">
                            <span class="stat-number" id="user-ads-count">0</span>
                            <span class="stat-label">–û–±—ä—è–≤–ª–µ–Ω–∏–π</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="user-favorites-count">0</span>
                            <span class="stat-label">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
                        </div>
                    </div>

                    <div class="profile-menu">
                        <button class="menu-item" onclick="switchTab('my-ads')">
                            <i class="fas fa-list"></i>
                            <span>–ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</span>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        <button class="menu-item" onclick="showEditProfile()">
                            <i class="fas fa-edit"></i>
                            <span>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</span>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        <button class="menu-item" onclick="showSettings()">
                            <i class="fas fa-cog"></i>
                            <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        <button class="menu-item" onclick="showAbout()">
                            <i class="fas fa-info-circle"></i>
                            <span>–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</span>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- –ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è -->
            <div class="tab-content" id="my-ads-tab" style="display: none;">
                <div class="section-header">
                    <h2>–ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</h2>
                    <button class="create-ad-btn" onclick="openCreateAd()">
                        <i class="fas fa-plus"></i>
                        <span>–°–æ–∑–¥–∞—Ç—å</span>
                    </button>
                </div>
                <div class="ads-grid" id="my-ads-grid">
                    <div class="loading-placeholder">
                        <div class="skeleton-card"></div>
                        <div class="skeleton-card"></div>
                    </div>
                </div>
            </div>

            <!-- –ê–¥–º–∏–Ω—Å–∫–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="tab-content" id="admin-tab" style="display: none;">
                <div class="admin-header">
                    <h2>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
                </div>
                
                <div class="admin-tabs">
                    <button class="admin-tab-btn active" onclick="showAdminSection('pending')">
                        <i class="fas fa-clock"></i>
                        <span>–ú–æ–¥–µ—Ä–∞—Ü–∏—è</span>
                    </button>
                    <button class="admin-tab-btn" onclick="showAdminSection('support')">
                        <i class="fas fa-headset"></i>
                        <span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</span>
                    </button>
                    <button class="admin-tab-btn" onclick="showAdminSection('payments')">
                        <i class="fas fa-credit-card"></i>
                        <span>–ü–ª–∞—Ç–µ–∂–∏</span>
                    </button>
                    <button class="admin-tab-btn" onclick="showAdminSection('users')">
                        <i class="fas fa-users"></i>
                        <span>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
                    </button>
                </div>

                <div class="admin-section" id="admin-pending">
                    <h3>üìã –û–±—ä—è–≤–ª–µ–Ω–∏—è –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</h3>
                    <div class="admin-content">
                        <p>–û–±—ä—è–≤–ª–µ–Ω–∏–π –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏: 0</p>
                    </div>
                </div>

                <div class="admin-section" id="admin-support" style="display: none;">
                    <h3>üéß –ó–∞–ø—Ä–æ—Å—ã –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É</h3>
                    <div class="admin-content">
                        <p>–ó–∞–ø—Ä–æ—Å–æ–≤ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É: 0</p>
                    </div>
                </div>

                <div class="admin-section" id="admin-payments" style="display: none;">
                    <h3>üí≥ –ü–ª–∞—Ç–µ–∂–∏</h3>
                    <div class="admin-content">
                        <p>–ü–ª–∞—Ç–µ–∂–µ–π: 0</p>
                    </div>
                </div>

                <div class="admin-section" id="admin-users" style="display: none;">
                    <h3>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
                    <div class="admin-content">
                        <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 0</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="tabbar" id="main-tabbar">
            <button class="tabbar-item active" data-tab="feed" onclick="switchTab('feed')">
                <i class="fas fa-home"></i>
                <span>–ì–ª–∞–≤–Ω–∞—è</span>
            </button>
            <button class="tabbar-item" data-tab="favorites" onclick="switchTab('favorites')">
                <i class="fas fa-heart"></i>
                <span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
            </button>
            <button class="tabbar-item" data-tab="messages" onclick="switchTab('messages')">
                <i class="fas fa-comment"></i>
                <span>–°–æ–æ–±—â–µ–Ω–∏—è</span>
            </button>
            <button class="tabbar-item" data-tab="profile" onclick="switchTab('profile')">
                <i class="fas fa-user"></i>
                <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
            </button>
        </nav>

        <!-- –ê–¥–º–∏–Ω—Å–∫–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="tabbar admin-tabbar" id="admin-tabbar" style="display: none;">
            <button class="tabbar-item active" data-tab="feed" onclick="switchTab('feed')">
                <i class="fas fa-home"></i>
                <span>–ì–ª–∞–≤–Ω–∞—è</span>
            </button>
            <button class="tabbar-item" data-tab="favorites" onclick="switchTab('favorites')">
                <i class="fas fa-heart"></i>
                <span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
            </button>
            <button class="tabbar-item" data-tab="messages" onclick="switchTab('messages')">
                <i class="fas fa-comment"></i>
                <span>–°–æ–æ–±—â–µ–Ω–∏—è</span>
            </button>
            <button class="tabbar-item" data-tab="admin" onclick="switchTab('admin')">
                <i class="fas fa-shield-alt"></i>
                <span>–ú–æ–¥–µ—Ä–∞—Ü–∏—è</span>
            </button>
        </nav>

        <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è -->
        <button class="fab-button" id="create-button" onclick="openCreateAd()">
            <i class="fas fa-plus"></i>
        </button>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è -->
        <div class="modal" id="create-ad-modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="back-btn" onclick="closeModal()">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h2>–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</h2>
                </div>
                <div class="modal-body">
                    <form id="create-ad-form">
                        <div class="form-group">
                            <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏—è *</label>
                            <input type="text" id="ad-title" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: iPhone 13 Pro Max">
                        </div>
                        <div class="form-group">
                            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                            <select id="ad-category" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                                <option value="transport">üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
                                <option value="electronics">üì± –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</option>
                                <option value="property">üè† –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</option>
                                <option value="clothing">üëï –û–¥–µ–∂–¥–∞</option>
                                <option value="jobs">üíº –†–∞–±–æ—Ç–∞</option>
                                <option value="services">üîß –£—Å–ª—É–≥–∏</option>
                                <option value="animals">üêæ –ñ–∏–≤–æ—Ç–Ω—ã–µ</option>
                                <option value="other">üì¶ –ü—Ä–æ—á–µ–µ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–¶–µ–Ω–∞</label>
                            <div class="price-input">
                                <input type="number" id="ad-price" placeholder="0">
                                <span class="currency">‚ÇΩ</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>–û–ø–∏—Å–∞–Ω–∏–µ *</label>
                            <textarea id="ad-description" rows="4" required placeholder="–û–ø–∏—à–∏—Ç–µ —Ç–æ–≤–∞—Ä –ø–æ–¥—Ä–æ–±–Ω–æ: —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–¥–∞–∂–∏..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ *</label>
                            <div class="location-section">
                                <button type="button" class="location-btn" onclick="getLocation()">
                                    <i class="fas fa-map-marker-alt"></i>
                                    <span>–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</span>
                                </button>
                                <div class="location-divider">–∏–ª–∏</div>
                                <input type="text" id="ad-location" placeholder="–£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å: –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –¢–≤–µ—Ä—Å–∫–∞—è, –¥. 1" required>
                                <div class="location-suggestions" id="location-suggestions" style="display: none;">
                                    <div class="suggestion-item" onclick="selectLocation('–≥. –ú–æ—Å–∫–≤–∞, –ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å')">–≥. –ú–æ—Å–∫–≤–∞, –ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å</div>
                                    <div class="suggestion-item" onclick="selectLocation('–≥. –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –ù–µ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç')">–≥. –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –ù–µ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç</div>
                                    <div class="suggestion-item" onclick="selectLocation('–≥. –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫, –ö—Ä–∞—Å–Ω—ã–π –ø—Ä–æ—Å–ø–µ–∫—Ç')">–≥. –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫, –ö—Ä–∞—Å–Ω—ã–π –ø—Ä–æ—Å–ø–µ–∫—Ç</div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</label>
                            <div class="photo-upload-area">
                                <input type="file" id="ad-photos" accept="image/*" multiple style="display: none;" onchange="handlePhotos(event)">
                                <div class="photo-grid" id="photo-grid">
                                    <div class="add-photo-btn" onclick="document.getElementById('ad-photos').click()">
                                        <i class="fas fa-camera"></i>
                                        <span>–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω *</label>
                            <input type="tel" id="ad-phone" placeholder="+7 XXX XXX-XX-XX" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn-primary" onclick="submitAd()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div class="notifications" id="notifications"></div>
    </div>

    <script src="app.js?v=4"></script>
    <script>
        // –ü–û–õ–ù–´–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ - –ì–ê–†–ê–ù–¢–ò–†–û–í–ê–ù–ù–ê–Ø –†–ê–ë–û–¢–ê
        console.log('üöÄ Lavka26 v4 - –ü–û–õ–ù–´–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ');
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentUser = null;
        let ads = [];
        let navigationHistory = ['feed'];
        let currentFilter = {
            search: '',
            category: '',
            sort: 'newest'
        };
        
        const API_BASE = 'https://lavka26-backend-rmr1.onrender.com/api';
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üì± DOM –∑–∞–≥—Ä—É–∂–µ–Ω');
            initApp();
        });
        
        function initApp() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.expand();
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥
                window.Telegram.WebApp.BackButton.onClick(() => {
                    goBack();
                });
                
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                currentUser = window.Telegram.WebApp.initDataUnsafe?.user;
                if (currentUser) {
                    console.log('üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Telegram:', currentUser);
                    checkAdmin();
                }
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            loadAds();
            setupEventListeners();
            
            console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
        }
        
        function setupEventListeners() {
            // –ü–æ–∏—Å–∫–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞
            const searchInput = document.getElementById('search-input');
            const searchCategory = document.getElementById('search-category');
            const categoryFilter = document.getElementById('category-filter');
            
            if (searchInput) {
                searchInput.addEventListener('focus', function() {
                    if (categoryFilter) {
                        categoryFilter.style.display = 'block';
                    }
                });
                
                let searchTimeout;
                searchInput.addEventListener('input', function() {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        currentFilter.search = this.value;
                        currentFilter.category = searchCategory ? searchCategory.value : '';
                        loadAds();
                    }, 500);
                });
            }
            
            if (searchCategory) {
                searchCategory.addEventListener('change', function() {
                    currentFilter.category = this.value;
                    loadAds();
                });
            }
        }
        
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        function switchTab(tabName) {
            console.log('üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞:', tabName);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
            if (navigationHistory[navigationHistory.length - 1] !== tabName) {
                navigationHistory.push(tabName);
            }
            
            updateHeader(tabName);
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å
            document.querySelectorAll('.tabbar-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            const tabElement = document.getElementById(tabName + '-tab');
            if (tabElement) {
                tabElement.style.display = 'block';
            }
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
            const activeBtn = document.querySelector(`.tabbar-item[data-tab="${tabName}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            switch(tabName) {
                case 'favorites':
                    loadFavorites();
                    break;
                case 'my-ads':
                    loadMyAds();
                    break;
                case 'profile':
                    loadProfile();
                    break;
                case 'admin':
                    if (currentUser && currentUser.id === 379036860) {
                        loadAdminPanel();
                    }
                    break;
            }
        }
        
        function updateHeader(tabName) {
            const headerTitle = document.getElementById('header-title');
            const backBtn = document.getElementById('back-btn');
            
            if (headerTitle) {
                const titles = {
                    'feed': 'Lavka26',
                    'favorites': '–ò–∑–±—Ä–∞–Ω–Ω–æ–µ',
                    'messages': '–°–æ–æ–±—â–µ–Ω–∏—è',
                    'profile': '–ü—Ä–æ—Ñ–∏–ª—å',
                    'my-ads': '–ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è',
                    'admin': '–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å'
                };
                headerTitle.textContent = titles[tabName] || 'Lavka26';
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞–∑–∞–¥
            if (backBtn) {
                if (navigationHistory.length > 1) {
                    backBtn.style.display = 'flex';
                    if (window.Telegram && window.Telegram.WebApp) {
                        window.Telegram.WebApp.BackButton.show();
                    }
                } else {
                    backBtn.style.display = 'none';
                    if (window.Telegram && window.Telegram.WebApp) {
                        window.Telegram.WebApp.BackButton.hide();
                    }
                }
            }
        }
        
        function goBack() {
            if (navigationHistory.length > 1) {
                navigationHistory.pop();
                const previousTab = navigationHistory[navigationHistory.length - 1];
                switchTab(previousTab);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        async function loadAds() {
            const adsList = document.getElementById('ads-grid');
            if (!adsList) return;
            
            adsList.innerHTML = `
                <div class="loading-placeholder">
                    <div class="skeleton-card"></div>
                    <div class="skeleton-card"></div>
                    <div class="skeleton-card"></div>
                </div>
            `;
            
            try {
                const params = new URLSearchParams();
                if (currentFilter.category) params.append('category', currentFilter.category);
                if (currentFilter.search) params.append('search', currentFilter.search);
                
                const response = await fetch(`${API_BASE}/ads?${params}`);
                if (response.ok) {
                    ads = await response.json();
                    renderAds(ads);
                } else {
                    // –ï—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ –Ω–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π
                    console.warn('API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫');
                    renderAds([]);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π:', error);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ –Ω–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π –≤–º–µ—Å—Ç–æ –æ—à–∏–±–∫–∏
                renderAds([]);
            }
        }
        
        function renderAds(adsToRender) {
            const adsList = document.getElementById('ads-grid');
            if (!adsList) return;
            
            if (adsToRender.length === 0) {
                adsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <p>–û–±—ä—è–≤–ª–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
                        <small>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã</small>
                    </div>
                `;
                return;
            }
            
            adsList.innerHTML = adsToRender.map(ad => `
                <div class="ad-card" onclick="openAd(${ad.id})">
                    <div class="ad-image">
                        ${ad.photo ? `<img src="${ad.photo}" alt="${ad.title}">` : '<i class="fas fa-image"></i>'}
                    </div>
                    <div class="ad-info">
                        <h3 class="ad-title">${ad.title}</h3>
                        <div class="ad-price">${ad.price ? ad.price + ' ‚ÇΩ' : '–î–æ–≥–æ–≤–æ—Ä–Ω–∞—è'}</div>
                        <div class="ad-location">
                            <i class="fas fa-map-marker-alt"></i>
                            ${ad.location || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
                        </div>
                        <div class="ad-date">${formatDate(ad.created_at)}</div>
                    </div>
                </div>
            `).join('');
        }
        
        // –ê–¥–º–∏–Ω—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function checkAdmin() {
            if (currentUser && currentUser.id === 379036860) {
                console.log('üõ°Ô∏è –ê–¥–º–∏–Ω detected');
                const adminTabbar = document.getElementById('admin-tabbar');
                if (adminTabbar) {
                    adminTabbar.style.display = 'flex';
                }
            }
        }
        
        function showAdminSection(section) {
            console.log('üõ°Ô∏è –ê–¥–º–∏–Ω —Å–µ–∫—Ü–∏—è:', section);
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
            document.querySelectorAll('.admin-section').forEach(sec => {
                sec.style.display = 'none';
            });
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å
            document.querySelectorAll('.admin-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å–µ–∫—Ü–∏—é
            const targetSection = document.getElementById(`admin-${section}`);
            if (targetSection) {
                targetSection.style.display = 'block';
            }
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
            if (event && event.target) {
                const btn = event.target.closest('.admin-tab-btn');
                if (btn) btn.classList.add('active');
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            switch(section) {
                case 'pending':
                    refreshPendingAds();
                    break;
                case 'support':
                    refreshSupportMessages();
                    break;
                case 'payments':
                    refreshPayments();
                    break;
                case 'users':
                    refreshUsers();
                    break;
            }
        }
        
        function refreshPendingAds() {
            console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏');
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
        }
        
        function refreshSupportMessages() {
            console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏');
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
        }
        
        function refreshPayments() {
            console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π');
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
        }
        
        function refreshUsers() {
            console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π');
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
        }
        
        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        function openCreateAd() {
            const modal = document.getElementById('create-ad-modal');
            if (modal) {
                modal.style.display = 'flex';
                showNotification('–°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è', 'info');
            }
        }
        
        function closeModal() {
            const modal = document.getElementById('create-ad-modal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        // –ü–æ–∏—Å–∫
        function performSearch() {
            const searchInput = document.getElementById('search-input');
            const searchCategory = document.getElementById('search-category');
            
            if (searchInput) {
                currentFilter.search = searchInput.value;
            }
            if (searchCategory) {
                currentFilter.category = searchCategory.value;
            }
            
            loadAds();
            showNotification('–ü–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω', 'success');
        }
        
        // –£—Ç–∏–ª–∏—Ç—ã
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            
            if (hours < 1) {
                const minutes = Math.floor(diff / (1000 * 60));
                return minutes + ' –º–∏–Ω –Ω–∞–∑–∞–¥';
            } else if (hours < 24) {
                return hours + ' —á –Ω–∞–∑–∞–¥';
            } else {
                const days = Math.floor(hours / 24);
                return days + ' –¥ –Ω–∞–∑–∞–¥';
            }
        }
        
        function showNotification(message, type = 'info') {
            const notifications = document.getElementById('notifications');
            if (!notifications) return;
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            notifications.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // –ó–∞–≥–ª—É—à–∫–∏ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π
        function loadFavorites() {
            console.log('üì• –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ');
        }
        
        function loadMyAds() {
            console.log('üì• –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–∏—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π');
        }
        
        function loadProfile() {
            console.log('üì• –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è');
        }
        
        function loadAdminPanel() {
            console.log('üì• –ó–∞–≥—Ä—É–∑–∫–∞ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏');
        }
        
        function filterByCategory(category) {
            currentFilter.category = category;
            loadAds();
            switchTab('feed');
        }
        
        function openAd(adId) {
            console.log('üìÑ –û—Ç–∫—Ä—ã—Ç–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è:', adId);
        }
        
        function showEditProfile() {
            console.log('‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è');
        }
        
        function showSettings() {
            console.log('‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏');
        }
        
        function showAbout() {
            console.log('‚ÑπÔ∏è –û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏');
        }
        
        function submitAd() {
            console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏—è');
            showNotification('–û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é', 'success');
            closeModal();
        }
        
        // –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
        function getLocation() {
            console.log('üìç –ó–∞–ø—Ä–æ—Å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏');
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        
                        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ–µ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
                        const locationInput = document.getElementById('ad-location');
                        if (locationInput) {
                            locationInput.value = `${lat.toFixed(6)}, ${lon.toFixed(6)}`;
                            showNotification('–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ', 'success');
                        }
                    },
                    (error) => {
                        console.error('–û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:', error);
                        showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ', 'error');
                    }
                );
            } else {
                showNotification('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', 'error');
            }
        }
        
        function selectLocation(address) {
            const locationInput = document.getElementById('ad-location');
            if (locationInput) {
                locationInput.value = address;
            }
            
            const suggestions = document.getElementById('location-suggestions');
            if (suggestions) {
                suggestions.style.display = 'none';
            }
        }
        
        // –§–æ—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∞
        let uploadedPhotos = [];
        
        function handlePhotos(event) {
            const files = event.target.files;
            const photoGrid = document.getElementById('photo-grid');
            
            if (!photoGrid) return;
            
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const photoId = Date.now() + Math.random();
                        uploadedPhotos.push({
                            id: photoId,
                            url: e.target.result,
                            file: file
                        });
                        
                        const photoItem = document.createElement('div');
                        photoItem.className = 'photo-item';
                        photoItem.innerHTML = `
                            <img src="${e.target.result}" alt="–§–æ—Ç–æ">
                            <button class="remove-photo" onclick="removePhoto(${photoId})">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                        
                        // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–¥ –∫–Ω–æ–ø–∫–æ–π –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
                        const addBtn = photoGrid.querySelector('.add-photo-btn');
                        if (addBtn) {
                            photoGrid.insertBefore(photoItem, addBtn);
                        }
                    };
                    
                    reader.readAsDataURL(file);
                }
            });
            
            // –û—á–∏—â–∞–µ–º input –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ—Ö –∂–µ —Ñ–∞–π–ª–æ–≤
            event.target.value = '';
        }
        
        function removePhoto(photoId) {
            uploadedPhotos = uploadedPhotos.filter(photo => photo.id !== photoId);
            
            const photoGrid = document.getElementById('photo-grid');
            if (photoGrid) {
                const photoItems = photoGrid.querySelectorAll('.photo-item');
                photoItems.forEach(item => {
                    const removeBtn = item.querySelector('.remove-photo');
                    if (removeBtn && removeBtn.getAttribute('onclick').includes(photoId)) {
                        item.remove();
                    }
                });
            }
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏ –∞–¥—Ä–µ—Å–∞ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ
        document.addEventListener('DOMContentLoaded', function() {
            const locationInput = document.getElementById('ad-location');
            const suggestions = document.getElementById('location-suggestions');
            
            if (locationInput && suggestions) {
                locationInput.addEventListener('focus', function() {
                    if (this.value.length === 0) {
                        suggestions.style.display = 'block';
                    }
                });
                
                locationInput.addEventListener('input', function() {
                    if (this.value.length > 0) {
                        suggestions.style.display = 'none';
                    } else {
                        suggestions.style.display = 'block';
                    }
                });
                
                locationInput.addEventListener('blur', function() {
                    setTimeout(() => {
                        suggestions.style.display = 'none';
                    }, 200);
                });
            }
        });
        
        // –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π
        window.switchTab = switchTab;
        window.goBack = goBack;
        window.performSearch = performSearch;
        window.showAdminSection = showAdminSection;
        window.openCreateAd = openCreateAd;
        window.closeModal = closeModal;
        window.filterByCategory = filterByCategory;
        window.openAd = openAd;
        window.showEditProfile = showEditProfile;
        window.showSettings = showSettings;
        window.showAbout = showAbout;
        window.submitAd = submitAd;
        window.getLocation = getLocation;
        window.selectLocation = selectLocation;
        window.handlePhotos = handlePhotos;
        window.removePhoto = removePhoto;
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        setTimeout(() => {
            console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤:');
            console.log('üîç –ö–Ω–æ–ø–∫–∞ –ø–æ–∏—Å–∫–∞:', document.querySelector('.search-btn') ? '‚úÖ' : '‚ùå');
            console.log('üîç –§–∏–ª—å—Ç—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π:', document.getElementById('category-filter') ? '‚úÖ' : '‚ùå');
            console.log('üîç –ê–¥–º–∏–Ω—Å–∫–∏–µ –≤–∫–ª–∞–¥–∫–∏:', document.querySelector('.admin-tabs') ? '‚úÖ' : '‚ùå');
            console.log('üîç –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥:', document.getElementById('back-btn') ? '‚úÖ' : '‚ùå');
            console.log('üîç –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è:', document.querySelector('.fab-button') ? '‚úÖ' : '‚ùå');
        }, 200);
    </script>
</body>
</html>
